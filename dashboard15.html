<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Traffic Exchange Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css">
    <style>
        /* CSS Variables */
        :root {
            --primary: #4F46E5;
            --primary-dark: #4338CA;
            --primary-light: #818CF8;
            --secondary: #10B981;
            --secondary-dark: #059669;
            --danger: #EF4444;
            --warning: #F59E0B;
            --info: #3B82F6;
            --dark: #1F2937;
            --light: #F9FAFB;
            --bg: #FFFFFF;
            --bg-secondary: #F3F4F6;
            --bg-tertiary: #E5E7EB;
            --text: #111827;
            --text-secondary: #6B7280;
            --text-tertiary: #9CA3AF;
            --border: #D1D5DB;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --radius: 8px;
            --radius-lg: 12px;
            --transition: all 0.3s ease;
            --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            --gradient-success: linear-gradient(135deg, var(--secondary) 0%, #34D399 100%);
            --gradient-danger: linear-gradient(135deg, var(--danger) 0%, #F87171 100%);
        }

        /* Dark Mode Variables */
        [data-theme="dark"] {
            --bg: #0F172A;
            --bg-secondary: #1E293B;
            --bg-tertiary: #334155;
            --text: #F1F5F9;
            --text-secondary: #CBD5E1;
            --text-tertiary: #94A3B8;
            --border: #334155;
            --dark: #F1F5F9;
            --light: #1E293B;
        }

        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
            transition: var(--transition);
            line-height: 1.6;
        }

        /* Dashboard Layout - Fixed height, no scrolling */
        .dashboard-layout {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }

        .nav-menu {
            padding: 1rem 0;
            flex: 1;
            overflow-y: auto;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
        }

        .nav-item:hover {
            background: var(--bg-tertiary);
            color: var(--primary);
        }

        .nav-item.active {
            background: var(--primary);
            color: white;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: 100vh;
        }

        /* Top Bar */
        .topbar {
            background: var(--bg);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
            flex-shrink: 0;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 0.5rem 1rem;
            width: 300px;
        }

        .search-bar input {
            border: none;
            background: none;
            outline: none;
            width: 100%;
            color: var(--text);
            margin-left: 0.5rem;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notification-btn, .theme-toggle {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .notification-btn:hover, .theme-toggle:hover {
            background: var(--bg-tertiary);
        }

        /* Page Container - Fixed height with internal scrolling */
        .page-container {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            height: calc(100vh - 70px);
        }

        /* Cards */
        .card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .stat-change {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius);
        }

        .stat-change.positive {
            color: var(--secondary);
            background: rgba(16, 185, 129, 0.1);
        }

        .stat-change.negative {
            color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }

        /* Buttons */
        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: var(--radius);
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
            border: none;
            outline: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
        }

        .btn-danger {
            background: var(--gradient-danger);
            color: white;
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.625rem 0.875rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--bg);
            color: var(--text);
            transition: var(--transition);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        /* Task Creation Wizard */
        .wizard-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .wizard-header {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .wizard-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
        }

        .wizard-step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 0.5rem;
            transition: var(--transition);
        }

        .wizard-step.active .step-number {
            background: var(--gradient-primary);
            color: white;
        }

        .wizard-step.completed .step-number {
            background: var(--gradient-success);
            color: white;
        }

        .step-title {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .wizard-step.active .step-title {
            color: var(--primary);
            font-weight: 600;
        }

        /* Step Content */
        .step-content {
            display: none;
            animation: fadeIn 0.3s;
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Website Preview */
        .website-preview {
            height: 500px;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            position: relative;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .website-preview iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: #fff;
        }

        /* XPath Overlay */
        .xpath-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 10;
        }

        .xpath-marker {
            position: absolute;
            width: 30px;
            height: 30px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transform: translate(-50%, -50%);
            pointer-events: auto;
            z-index: 20;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(79, 70, 229, 0); }
            100% { box-shadow: 0 0 0 0 rgba(79, 70, 229, 0); }
        }

        .xpath-marker:hover {
            transform: translate(-50%, -50%) scale(1.1);
        }

        /* Priority Options */
        .priority-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .priority-option {
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .priority-option:hover {
            border-color: var(--primary-light);
            transform: translateY(-2px);
        }

        .priority-option.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.05) 0%, rgba(129, 140, 248, 0.05) 100%);
        }

        .priority-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .priority-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .priority-price {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        /* Keywords Section */
        .keyword-input-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .keyword-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .keyword-tag {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 0.5rem 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .keyword-tag .remove-btn {
            cursor: pointer;
            color: var(--text-secondary);
        }

        .keyword-tag .remove-btn:hover {
            color: var(--danger);
        }

        /* Payment Methods */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .payment-method {
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .payment-method:hover {
            border-color: var(--primary-light);
        }

        .payment-method.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.05) 0%, rgba(129, 140, 248, 0.05) 100%);
        }

        /* Order Summary */
        .order-summary {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            color: var(--text-secondary);
        }

        .summary-row.total {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text);
            border-top: 2px solid var(--border);
            padding-top: 0.75rem;
            margin-top: 0.75rem;
        }

        /* Step Navigation */
        .step-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -250px;
                z-index: 1000;
            }

            .sidebar.active {
                left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .priority-grid {
                grid-template-columns: 1fr;
            }

            .wizard-steps {
                flex-direction: column;
            }
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--bg-tertiary);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 10000;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .toast.success {
            border-left: 4px solid var(--secondary);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast.warning {
            border-left: 4px solid var(--warning);
        }

        .toast.info {
            border-left: 4px solid var(--info);
        }

        /* Preview Controls */
        .preview-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px;
            border-radius: var(--radius);
            z-index: 30;
        }

        .preview-btn {
            background: transparent;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 4px 8px;
            margin: 0 2px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .preview-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Click Detection Layer */
        .click-detector {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 15;
            cursor: crosshair;
        }

        /* Selected Locations Display */
        .location-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius);
            margin-bottom: 0.5rem;
        }

        .location-xpath {
            font-family: monospace;
            font-size: 0.875rem;
            background: var(--bg);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="ri-exchange-line"></i>
                    <span>SEO Exchange</span>
                </div>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item" onclick="showSection('dashboard')">
                    <i class="ri-dashboard-line"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item active" onclick="showSection('create-task')">
                    <i class="ri-add-circle-line"></i>
                    <span>Create Task</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('my-tasks')">
                    <i class="ri-task-line"></i>
                    <span>My Tasks</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('browse-tasks')">
                    <i class="ri-search-eye-line"></i>
                    <span>Browse Tasks</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('analytics')">
                    <i class="ri-bar-chart-line"></i>
                    <span>Analytics</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('payments')">
                    <i class="ri-wallet-line"></i>
                    <span>Payments</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('settings')">
                    <i class="ri-settings-line"></i>
                    <span>Settings</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="topbar">
                <div class="search-bar">
                    <i class="ri-search-line"></i>
                    <input type="text" placeholder="Search...">
                </div>
                <div class="user-menu">
                    <button class="notification-btn">
                        <i class="ri-notification-line"></i>
                    </button>
                    <button class="theme-toggle" onclick="toggleTheme()">
                        <i class="ri-moon-line"></i>
                    </button>
                    <div class="user-avatar">
                        <img src="https://ui-avatars.com/api/?name=User&background=4F46E5&color=fff" alt="User" style="width: 36px; height: 36px; border-radius: 50%;">
                    </div>
                </div>
            </header>

            <!-- Page Container -->
            <div class="page-container">
                <div class="wizard-container">
                    <!-- Wizard Header -->
                    <div class="wizard-header">
                        <div class="wizard-steps">
                            <div class="wizard-step active" id="wizard-step-1">
                                <div class="step-number">1</div>
                                <div class="step-title">Website Details</div>
                            </div>
                            <div class="wizard-step" id="wizard-step-2">
                                <div class="step-number">2</div>
                                <div class="step-title">Select Locations</div>
                            </div>
                            <div class="wizard-step" id="wizard-step-3">
                                <div class="step-number">3</div>
                                <div class="step-title">Keywords & Payment</div>
                            </div>
                            <div class="wizard-step" id="wizard-step-4">
                                <div class="step-number">4</div>
                                <div class="step-title">Review & Launch</div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 1: Website Details -->
                    <div class="step-content active" id="step1">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Enter Website Details</h3>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Website URL</label>
                                <input type="url" class="form-input" id="websiteUrl" placeholder="https://example.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Task Priority</label>
                                <div class="priority-grid">
                                    <div class="priority-option" data-priority="basic" onclick="selectPriority('basic')">
                                        <div class="priority-icon">ü•â</div>
                                        <div class="priority-name">Basic</div>
                                        <div class="priority-price">$0.25</div>
                                        <div style="font-size: 0.875rem; color: var(--text-secondary);">per click</div>
                                    </div>
                                    <div class="priority-option selected" data-priority="standard" onclick="selectPriority('standard')">
                                        <div class="priority-icon">ü•à</div>
                                        <div class="priority-name">Standard</div>
                                        <div class="priority-price">$0.50</div>
                                        <div style="font-size: 0.875rem; color: var(--text-secondary);">per click</div>
                                    </div>
                                    <div class="priority-option" data-priority="premium" onclick="selectPriority('premium')">
                                        <div class="priority-icon">ü•á</div>
                                        <div class="priority-name">Premium</div>
                                        <div class="priority-price">$1.00</div>
                                        <div style="font-size: 0.875rem; color: var(--text-secondary);">per click</div>
                                    </div>
                                </div>
                            </div>
                            <div class="step-navigation">
                                <button class="btn btn-secondary" disabled>Back</button>
                                <button class="btn btn-primary" onclick="goToStep(2)">Next: Select Locations</button>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Select Locations -->
                    <div class="step-content" id="step2">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Select Click Locations</h3>
                            </div>
                            
                            <div class="website-preview" id="websitePreview">
                                <div id="websiteLoader" style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f5f5f5;">
                                    <div class="spinner"></div>
                                </div>
                                <iframe id="taskPreviewFrame" style="display: none;"></iframe>
                                <div id="xpathOverlay" class="xpath-overlay"></div>
                                <div id="clickDetector" class="click-detector" style="display: none;"></div>
                                <div class="preview-controls">
                                    <button class="preview-btn" onclick="setZoom(0.5)">50%</button>
                                    <button class="preview-btn" onclick="setZoom(0.75)">75%</button>
                                    <button class="preview-btn" onclick="setZoom(1)">100%</button>
                                </div>
                            </div>

                            <div style="margin-top: 1rem;">
                                <h4>Selected Click Locations (<span id="locationCount">0</span>/<span id="maxLocations">3</span>)</h4>
                                <div id="selectedLocations" style="max-height: 200px; overflow-y: auto;">
                                    <p style="color: var(--text-secondary); font-size: 0.875rem;">Click on the website preview to select clickable areas.</p>
                                </div>
                            </div>

                            <div class="step-navigation">
                                <button class="btn btn-secondary" onclick="goToStep(1)">Back</button>
                                <button class="btn btn-primary" onclick="goToStep(3)">Next: Keywords & Payment</button>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Keywords & Payment -->
                    <div class="step-content" id="step3">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Keywords & Payment</h3>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Target Keywords (Optional)</label>
                                <div class="keyword-input-group">
                                    <input type="text" class="form-input" id="keywordInput" placeholder="Enter keyword">
                                    <button class="btn btn-primary" onclick="addKeyword()">Add</button>
                                </div>
                                <div class="keyword-tags" id="keywordTags"></div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Budget</label>
                                <input type="number" class="form-input" id="budget" placeholder="Enter budget amount" min="10" value="50">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Payment Method</label>
                                <div class="payment-methods">
                                    <div class="payment-method selected" data-method="balance">
                                        <i class="ri-wallet-line" style="font-size: 2rem;"></i>
                                        <div>Account Balance</div>
                                    </div>
                                    <div class="payment-method" data-method="crypto">
                                        <i class="ri-bit-coin-line" style="font-size: 2rem;"></i>
                                        <div>Cryptocurrency</div>
                                    </div>
                                    <div class="payment-method" data-method="card">
                                        <i class="ri-bank-card-line" style="font-size: 2rem;"></i>
                                        <div>Credit Card</div>
                                    </div>
                                </div>
                            </div>

                            <div class="step-navigation">
                                <button class="btn btn-secondary" onclick="goToStep(2)">Back</button>
                                <button class="btn btn-primary" onclick="goToStep(4)">Review Order</button>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Review & Launch -->
                    <div class="step-content" id="step4">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Review & Launch Task</h3>
                            </div>
                            
                            <div class="order-summary">
                                <h4 style="margin-bottom: 1rem;">Order Summary</h4>
                                <div class="summary-row">
                                    <span>Website URL:</span>
                                    <span id="summaryUrl">-</span>
                                </div>
                                <div class="summary-row">
                                    <span>Priority:</span>
                                    <span id="summaryPriority">-</span>
                                </div>
                                <div class="summary-row">
                                    <span>Click Locations:</span>
                                    <span id="summaryLocations">-</span>
                                </div>
                                <div class="summary-row">
                                    <span>Keywords:</span>
                                    <span id="summaryKeywords">-</span>
                                </div>
                                <div class="summary-row">
                                    <span>Payment Method:</span>
                                    <span id="summaryPayment">-</span>
                                </div>
                                <div class="summary-row total">
                                    <span>Total Budget:</span>
                                    <span id="summaryTotal">$0.00</span>
                                </div>
                            </div>

                            <div class="step-navigation">
                                <button class="btn btn-secondary" onclick="goToStep(3)">Back</button>
                                <button class="btn btn-success" onclick="launchTask()">
                                    <i class="ri-rocket-line"></i>
                                    Launch Task
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Global state
        let currentData = {
            websiteUrl: '',
            taskPriority: 'standard',
            selectedLocations: [],
            keywords: [],
            budget: 50,
            paymentMethod: 'balance',
            currentStep: 1
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateMaxLocations();
        });

        // Theme toggle
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const icon = document.querySelector('.theme-toggle i');
            icon.className = newTheme === 'dark' ? 'ri-sun-line' : 'ri-moon-line';
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        if (savedTheme === 'dark') {
            document.querySelector('.theme-toggle i').className = 'ri-sun-line';
        }

        // Navigation
        function showSection(section) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
            
            // Here you would load the appropriate section content
            console.log('Loading section:', section);
        }

        // Wizard navigation
        function goToStep(step) {
            // Validate current step
            if (step === 2 && !currentData.websiteUrl) {
                currentData.websiteUrl = document.getElementById('websiteUrl').value;
                if (!currentData.websiteUrl) {
                    showToast('Please enter a website URL', 'error');
                    return;
                }
                loadWebsitePreview();
            }

            if (step === 3 && currentData.selectedLocations.length === 0) {
                showToast('Please select at least one click location', 'error');
                return;
            }

            if (step === 4) {
                updateSummary();
            }

            // Update wizard steps
            document.querySelectorAll('.wizard-step').forEach((wizStep, index) => {
                wizStep.classList.remove('active', 'completed');
                if (index + 1 < step) {
                    wizStep.classList.add('completed');
                } else if (index + 1 === step) {
                    wizStep.classList.add('active');
                }
            });

            // Show appropriate content
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`step${step}`).classList.add('active');

            currentData.currentStep = step;
        }

        // Priority selection
        function selectPriority(priority) {
            document.querySelectorAll('.priority-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-priority="${priority}"]`).classList.add('selected');
            currentData.taskPriority = priority;
            
            // Update max locations if on step 2
            if (currentData.currentStep === 2) {
                updateMaxLocations();
                enforceLocationLimit();
            }
        }

        // Update max locations display
        function updateMaxLocations() {
            const limits = { basic: 2, standard: 3, premium: 5 };
            const maxLocations = limits[currentData.taskPriority] || 3;
            const maxLocElement = document.getElementById('maxLocations');
            if (maxLocElement) {
                maxLocElement.textContent = maxLocations;
            }
            return maxLocations;
        }

        // Enforce location limit
        function enforceLocationLimit() {
            const maxLocations = updateMaxLocations();
            if (currentData.selectedLocations.length > maxLocations) {
                currentData.selectedLocations = currentData.selectedLocations.slice(0, maxLocations);
                updateLocationDisplay();
                showToast(`Reduced to ${maxLocations} locations for ${currentData.taskPriority} priority`, 'warning');
            }
        }

        // Load website preview with proper XPath extraction
        function loadWebsitePreview() {
            const url = currentData.websiteUrl;
            const iframe = document.getElementById('taskPreviewFrame');
            const loader = document.getElementById('websiteLoader');
            const overlay = document.getElementById('xpathOverlay');
            const clickDetector = document.getElementById('clickDetector');

            // Validate URL
            let validUrl = url;
            if (!validUrl.startsWith('http://') && !validUrl.startsWith('https://')) {
                validUrl = 'https://' + validUrl;
            }

            // Clear existing locations
            currentData.selectedLocations = [];
            overlay.innerHTML = '';
            updateLocationDisplay();

            // Show loader
            loader.style.display = 'flex';
            iframe.style.display = 'none';
            clickDetector.style.display = 'none';

            // Create a proxy URL or use direct URL
            iframe.src = validUrl;

            iframe.onload = function() {
                loader.style.display = 'none';
                iframe.style.display = 'block';
                clickDetector.style.display = 'block';

                // Try to inject XPath extraction script
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    
                    // Inject XPath extraction function
                    const script = iframeDoc.createElement('script');
                    script.textContent = `
                        // Function to get XPath of an element
                        function getElementXPath(element) {
                            if (element.id !== '') {
                                return '//*[@id="' + element.id + '"]';
                            }
                            
                            if (element === document.body) {
                                return '/html/body';
                            }
                            
                            let path = [];
                            let current = element;
                            
                            while (current && current.nodeType === Node.ELEMENT_NODE) {
                                let index = 0;
                                let hasFollowingSiblings = false;
                                let sibling = current.previousSibling;
                                
                                while (sibling) {
                                    if (sibling.nodeType === Node.ELEMENT_NODE && sibling.nodeName === current.nodeName) {
                                        index++;
                                    }
                                    sibling = sibling.previousSibling;
                                }
                                
                                sibling = current.nextSibling;
                                while (sibling) {
                                    if (sibling.nodeType === Node.ELEMENT_NODE && sibling.nodeName === current.nodeName) {
                                        hasFollowingSiblings = true;
                                        break;
                                    }
                                    sibling = sibling.nextSibling;
                                }
                                
                                let tagName = current.nodeName.toLowerCase();
                                let pathIndex = (index || hasFollowingSiblings) ? '[' + (index + 1) + ']' : '';
                                path.unshift(tagName + pathIndex);
                                
                                current = current.parentNode;
                            }
                            
                            return path.length ? '/' + path.join('/') : null;
                        }
                        
                        // Send element info to parent
                        document.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            
                            const xpath = getElementXPath(e.target);
                            const rect = e.target.getBoundingClientRect();
                            
                            window.parent.postMessage({
                                type: 'element-clicked',
                                xpath: xpath,
                                x: rect.left + window.scrollX,
                                y: rect.top + window.scrollY,
                                tagName: e.target.tagName,
                                text: e.target.textContent.substring(0, 50)
                            }, '*');
                            
                            return false;
                        }, true);
                        
                        // Prevent navigation
                        document.addEventListener('click', function(e) {
                            if (e.target.tagName === 'A') {
                                e.preventDefault();
                                return false;
                            }
                        }, true);
                    `;
                    iframeDoc.head.appendChild(script);
                    
                    // Add styles to show clickable elements
                    const style = iframeDoc.createElement('style');
                    style.textContent = `
                        a, button, [onclick], input[type="submit"], input[type="button"] {
                            cursor: crosshair !important;
                        }
                        a:hover, button:hover, [onclick]:hover {
                            outline: 2px solid #4F46E5 !important;
                            outline-offset: 2px;
                        }
                    `;
                    iframeDoc.head.appendChild(style);
                    
                } catch (e) {
                    console.log('Cannot access iframe content - may be cross-origin');
                    // Fall back to overlay clicking
                }

                showToast('Click on elements in the website to select them', 'info');
            };

            iframe.onerror = function() {
                loader.innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                        <div style="font-size: 1.1rem; margin-bottom: 1rem;">Unable to load website preview</div>
                        <div style="font-size: 0.875rem; color: var(--text-tertiary);">
                            The website may block iframe embedding.<br>
                            You can manually enter XPath expressions.
                        </div>
                        <button class="btn btn-primary" onclick="showManualXPathInput()" style="margin-top: 1rem;">
                            Enter XPaths Manually
                        </button>
                    </div>
                `;
            };
        }

        // Listen for messages from iframe
        window.addEventListener('message', function(e) {
            if (e.data.type === 'element-clicked') {
                handleElementClick(e.data);
            }
        });

        // Handle element click from iframe
        function handleElementClick(data) {
            const maxLocations = updateMaxLocations();
            
            if (currentData.selectedLocations.length >= maxLocations) {
                showToast(`Maximum ${maxLocations} locations allowed for ${currentData.taskPriority} priority`, 'warning');
                return;
            }

            const locationId = Date.now() + Math.random();
            
            // Add to locations array
            currentData.selectedLocations.push({
                id: locationId,
                xpath: data.xpath,
                x: data.x,
                y: data.y,
                tagName: data.tagName,
                text: data.text
            });

            // Add visual marker
            addMarker(locationId, data.x, data.y);
            
            // Update display
            updateLocationDisplay();
            
            showToast(`Location ${currentData.selectedLocations.length} added: ${data.tagName}`, 'success');
        }

        // Handle click on detector overlay (fallback)
        document.addEventListener('DOMContentLoaded', function() {
            const clickDetector = document.getElementById('clickDetector');
            if (clickDetector) {
                clickDetector.addEventListener('click', function(e) {
                    const iframe = document.getElementById('taskPreviewFrame');
                    const rect = iframe.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    // Try to get element at this position
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        const element = iframeDoc.elementFromPoint(x, y);
                        
                        if (element) {
                            // Generate XPath for the element
                            const xpath = getElementXPath(element);
                            handleElementClick({
                                xpath: xpath,
                                x: x,
                                y: y,
                                tagName: element.tagName,
                                text: element.textContent.substring(0, 50)
                            });
                        }
                    } catch (e) {
                        // If we can't access iframe, use position-based XPath
                        const xpath = generatePositionBasedXPath(x, y);
                        handleElementClick({
                            xpath: xpath,
                            x: x,
                            y: y,
                            tagName: 'UNKNOWN',
                            text: ''
                        });
                    }
                });
            }
        });

        // Get XPath of element
        function getElementXPath(element) {
            if (element.id !== '') {
                return '//*[@id="' + element.id + '"]';
            }
            
            if (element === document.body) {
                return '/html/body';
            }
            
            let path = [];
            let current = element;
            
            while (current && current.nodeType === Node.ELEMENT_NODE) {
                let index = 0;
                let hasFollowingSiblings = false;
                let sibling = current.previousSibling;
                
                while (sibling) {
                    if (sibling.nodeType === Node.ELEMENT_NODE && sibling.nodeName === current.nodeName) {
                        index++;
                    }
                    sibling = sibling.previousSibling;
                }
                
                sibling = current.nextSibling;
                while (sibling) {
                    if (sibling.nodeType === Node.ELEMENT_NODE && sibling.nodeName === current.nodeName) {
                        hasFollowingSiblings = true;
                        break;
                    }
                    sibling = sibling.nextSibling;
                }
                
                let tagName = current.nodeName.toLowerCase();
                let pathIndex = (index || hasFollowingSiblings) ? '[' + (index + 1) + ']' : '';
                path.unshift(tagName + pathIndex);
                
                current = current.parentNode;
            }
            
            return path.length ? '/' + path.join('/') : null;
        }

        // Generate position-based XPath (fallback)
        function generatePositionBasedXPath(x, y) {
            const iframe = document.getElementById('taskPreviewFrame');
            const rect = iframe.getBoundingClientRect();
            const relativeY = y / rect.height;
            
            // Estimate section based on position
            if (relativeY < 0.15) {
                return `/html/body/header//a[${Math.floor(x / 100) + 1}]`;
            } else if (relativeY < 0.25) {
                return `/html/body/nav//a[${Math.floor(x / 100) + 1}]`;
            } else if (relativeY < 0.85) {
                return `/html/body/main//a[${Math.floor(x / 100) + 1}]`;
            } else {
                return `/html/body/footer//a[${Math.floor(x / 100) + 1}]`;
            }
        }

        // Add visual marker
        function addMarker(locationId, x, y) {
            const overlay = document.getElementById('xpathOverlay');
            const iframe = document.getElementById('taskPreviewFrame');
            const rect = iframe.getBoundingClientRect();
            
            const marker = document.createElement('div');
            marker.className = 'xpath-marker';
            marker.dataset.locationId = locationId;
            marker.style.left = x + 'px';
            marker.style.top = y + 'px';
            marker.innerHTML = currentData.selectedLocations.length;
            
            marker.onclick = function(e) {
                e.stopPropagation();
                removeLocation(locationId);
            };
            
            overlay.appendChild(marker);
        }

        // Update location display
        function updateLocationDisplay() {
            const container = document.getElementById('selectedLocations');
            const countElement = document.getElementById('locationCount');
            
            if (countElement) {
                countElement.textContent = currentData.selectedLocations.length;
            }
            
            if (!container) return;
            
            if (currentData.selectedLocations.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); font-size: 0.875rem;">Click on the website preview to select clickable areas.</p>';
                return;
            }
            
            container.innerHTML = currentData.selectedLocations.map((location, index) => `
                <div class="location-item">
                    <div>
                        <span style="font-weight: 500;">Location ${index + 1}:</span>
                        <span class="location-xpath">${location.xpath}</span>
                        ${location.tagName ? `<span style="margin-left: 0.5rem; color: var(--text-secondary);">&lt;${location.tagName}&gt;</span>` : ''}
                    </div>
                    <button class="btn btn-sm btn-danger" onclick="removeLocation('${location.id}')">
                        <i class="ri-delete-bin-line"></i>
                    </button>
                </div>
            `).join('');
        }

        // Remove location
        function removeLocation(locationId) {
            currentData.selectedLocations = currentData.selectedLocations.filter(loc => loc.id != locationId);
            
            // Remove marker
            const marker = document.querySelector(`[data-location-id="${locationId}"]`);
            if (marker) {
                marker.remove();
            }
            
            // Re-number remaining markers
            const overlay = document.getElementById('xpathOverlay');
            const markers = overlay.querySelectorAll('.xpath-marker');
            markers.forEach((marker, index) => {
                marker.innerHTML = index + 1;
            });
            
            updateLocationDisplay();
            showToast('Location removed', 'info');
        }

        // Show manual XPath input
        function showManualXPathInput() {
            const container = document.getElementById('selectedLocations');
            const maxLocations = updateMaxLocations();
            
            container.innerHTML = `
                <div style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--radius); border: 1px solid var(--border);">
                    <h4 style="margin-bottom: 1rem;">Add XPath Locations Manually</h4>
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                        <input type="text" class="form-input" id="manualXPath" placeholder="/html/body/header/div[1]/nav/ul/li[5]/a" style="flex: 1;">
                        <button class="btn btn-primary" onclick="addManualXPath()">
                            <i class="ri-add-line"></i> Add
                        </button>
                    </div>
                    <small style="color: var(--text-secondary);">
                        Enter XPath expressions. Examples:<br>
                        ‚Ä¢ /html/body/header/div[1]/nav/ul/li[5]/a<br>
                        ‚Ä¢ //button[@class="submit-btn"]<br>
                        ‚Ä¢ //*[@id="search-button"]<br>
                        You can add up to ${maxLocations} locations for ${currentData.taskPriority} priority.
                    </small>
                    <div id="manualLocationsList" style="margin-top: 1rem;">
                        ${currentData.selectedLocations.length > 0 ? 
                            currentData.selectedLocations.map((loc, index) => `
                                <div class="location-item">
                                    <div>
                                        <span style="font-weight: 500;">Location ${index + 1}:</span>
                                        <span class="location-xpath">${loc.xpath}</span>
                                    </div>
                                    <button class="btn btn-sm btn-danger" onclick="removeLocation('${loc.id}')">
                                        <i class="ri-delete-bin-line"></i>
                                    </button>
                                </div>
                            `).join('') : 
                            '<p style="color: var(--text-secondary); font-size: 0.875rem;">No locations added yet.</p>'
                        }
                    </div>
                </div>
            `;
        }

        // Add manual XPath
        function addManualXPath() {
            const input = document.getElementById('manualXPath');
            const xpath = input.value.trim();
            
            if (!xpath) {
                showToast('Please enter an XPath expression', 'error');
                return;
            }
            
            const maxLocations = updateMaxLocations();
            if (currentData.selectedLocations.length >= maxLocations) {
                showToast(`Maximum ${maxLocations} locations allowed for ${currentData.taskPriority} priority`, 'warning');
                return;
            }
            
            const locationId = Date.now() + Math.random();
            currentData.selectedLocations.push({
                id: locationId,
                xpath: xpath,
                x: 0,
                y: 0,
                manual: true
            });
            
            input.value = '';
            
            // Update the manual locations list
            const listContainer = document.getElementById('manualLocationsList');
            if (listContainer) {
                listContainer.innerHTML = currentData.selectedLocations.map((loc, index) => `
                    <div class="location-item">
                        <div>
                            <span style="font-weight: 500;">Location ${index + 1}:</span>
                            <span class="location-xpath">${loc.xpath}</span>
                            ${loc.manual ? '<span class="badge badge-warning" style="margin-left: 0.5rem;">Manual</span>' : ''}
                        </div>
                        <button class="btn btn-sm btn-danger" onclick="removeLocation('${loc.id}')">
                            <i class="ri-delete-bin-line"></i>
                        </button>
                    </div>
                `).join('');
            }
            
            updateLocationDisplay();
            showToast('XPath location added successfully', 'success');
        }

        // Set zoom for preview
        function setZoom(scale) {
            const iframe = document.getElementById('taskPreviewFrame');
            if (iframe) {
                iframe.style.transform = `scale(${scale})`;
                iframe.style.transformOrigin = '0 0';
                iframe.style.width = `${100/scale}%`;
                iframe.style.height = `${100/scale}%`;
            }
        }

        // Keywords
        function addKeyword() {
            const input = document.getElementById('keywordInput');
            const keyword = input.value.trim();
            
            if (!keyword) return;
            
            if (currentData.keywords.includes(keyword)) {
                showToast('Keyword already added', 'warning');
                return;
            }
            
            currentData.keywords.push(keyword);
            input.value = '';
            updateKeywordTags();
        }

        function updateKeywordTags() {
            const container = document.getElementById('keywordTags');
            container.innerHTML = currentData.keywords.map(keyword => `
                <div class="keyword-tag">
                    ${keyword}
                    <span class="remove-btn" onclick="removeKeyword('${keyword}')">√ó</span>
                </div>
            `).join('');
        }

        function removeKeyword(keyword) {
            currentData.keywords = currentData.keywords.filter(k => k !== keyword);
            updateKeywordTags();
        }

        // Payment method selection
        document.addEventListener('click', function(e) {
            if (e.target.closest('.payment-method')) {
                document.querySelectorAll('.payment-method').forEach(method => {
                    method.classList.remove('selected');
                });
                const method = e.target.closest('.payment-method');
                method.classList.add('selected');
                currentData.paymentMethod = method.dataset.method;
            }
        });

        // Update summary
        function updateSummary() {
            currentData.budget = parseFloat(document.getElementById('budget').value) || 50;
            
            document.getElementById('summaryUrl').textContent = currentData.websiteUrl;
            document.getElementById('summaryPriority').textContent = currentData.taskPriority.charAt(0).toUpperCase() + currentData.taskPriority.slice(1);
            document.getElementById('summaryLocations').textContent = currentData.selectedLocations.length + ' locations';
            document.getElementById('summaryKeywords').textContent = currentData.keywords.length > 0 ? currentData.keywords.join(', ') : 'None';
            document.getElementById('summaryPayment').textContent = currentData.paymentMethod.charAt(0).toUpperCase() + currentData.paymentMethod.slice(1);
            document.getElementById('summaryTotal').textContent = '$' + currentData.budget.toFixed(2);
        }

        // Launch task
        function launchTask() {
            showToast('Launching task...', 'info');
            
            // Here you would send the task data to your backend
            console.log('Task data:', currentData);
            
            setTimeout(() => {
                showToast('Task launched successfully!', 'success');
                // Reset form or redirect
                setTimeout(() => {
                    goToStep(1);
                    // Reset data
                    currentData = {
                        websiteUrl: '',
                        taskPriority: 'standard',
                        selectedLocations: [],
                        keywords: [],
                        budget: 50,
                        paymentMethod: 'balance',
                        currentStep: 1
                    };
                    document.getElementById('websiteUrl').value = '';
                    document.getElementById('budget').value = '50';
                    document.getElementById('keywordTags').innerHTML = '';
                }, 2000);
            }, 1500);
        }

        // Toast notification
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'ri-check-line',
                error: 'ri-error-warning-line',
                warning: 'ri-alert-line',
                info: 'ri-information-line'
            };
            
            toast.innerHTML = `
                <i class="${icons[type]}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideDown 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        @keyframes slideDown {
            to { transform: translateY(100%); opacity: 0; }
        }
    </script>
</body>
</html>